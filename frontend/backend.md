# Ether Backend Standards & Conventions

This document defines the strict standards for the Ether backend to ensure compatibility with the frontend (Electron/Vue).

## 1. Architecture Overview

-   **API Protocol**: REST (JSON)
-   **Real-time**: Socket.IO (v4)
-   **File Storage**: Cloudinary
-   **Auth**: JWT (Bearer Token)

## 2. API Endpoints

All endpoints must return JSON.
Success format: `{ ...data }` or `{ success: true, ...data }`
Error format: `{ message: "Error description", code: "ERROR_CODE" }` (HTTP 4xx/5xx)

### Authentication (`/auth`)
-   `POST /auth/login`
    -   **Request**: `{ email, password }`
    -   **Response**: `{ token: "jwt...", user: { id, username, email, avatar } }`
-   `POST /auth/register`
    -   **Request**: `{ username, email, password }`
    -   **Response**: `{ token, user }`

### Games (`/games`)
-   `GET /games/all`
    -   **Response**: `[{ _id, game_name, slug, description, image_url, price, developer }]`
-   `GET /dev-games`
    -   **Response**: `{ success: true, games: [{ gameId, gameName, version, ... }] }`
-   `GET /games/:id`
    -   **Response**: `{ _id, game_name, slug, description, image_url, downloadUrl, version, ... }`
-   `GET /games/:id/manifest`
    -   **Response**: `{ version: "1.0.0", downloadUrl: "...", executable_path: "Game.exe", size: 123456, hash: "..." }`

### Library (`/library`)
-   `GET /library/my-games`
    -   **Headers**: `Authorization: Bearer <token>`
    -   **Response**: `[{ _id, game_name, installed: boolean, ... }]`
-   `POST /library/purchase-game`
    -   **Request**: `{ gameId }`
    -   **Response**: `{ success: true }`
-   `POST /installation/status`
    -   **Request**: `{ gameId, status: "installed" | "uninstalling", path }`
    -   **Response**: `{ success: true }`

### Friends (`/friends`)
-   `GET /friends/list`
    -   **Response**: `[{ id, username, status: "online" | "offline" | "in-game", avatar }]`
-   `POST /friends/add`
    -   **Request**: `{ friendId }`

## 3. WebSocket Events

Namespace: `/` (Default)
Auth: Handshake auth `{ token: "..." }`

### Client -> Server
-   `chat:send`: `{ recipientId, content }`
-   `lobby:invite`: `{ userId, lobbyId }`

### Server -> Client
-   `friend:status-changed`: `{ userId, status }`
-   `friend:request-sent`: `{ requestId, fromUser }`
-   `chat:message-received`: `{ message: { id, content, senderId, timestamp } }`
-   `lobby:invite-received`: `{ lobbyId, fromUser }`

## 4. Cloudinary & Manifest Standards

### Folder Structure
`games/{slug}/{version}/`

### Manifest (`manifest.json`)
MUST be present in the Cloudinary folder and the downloaded zip.

```json
{
  "gameId": "string (slug)",
  "gameName": "string",
  "version": "x.y.z",
  "platform": "exe" | "html",
  "executable_path": "path/to/executable.exe",
  "downloadUrl": "https://res.cloudinary.com/.../game.zip",
  "size": 123456789,
  "hash": "sha256..."
}
```

## 5. Versioning & Updates

1.  **Detection**: Frontend compares local `installed.json` version with remote `manifest.json` version.
2.  **Update**: If remote > local, "Update" button appears.
3.  **Process**:
    -   Fetch `/games/:id/manifest`
    -   Download `downloadUrl`
    -   Extract to `installPath/Ether/{slug}`
    -   Write `installed.json` with new version.

## 6. GitHub Actions Integration

Workflows must:
1.  Build the game.
2.  Zip the build (`game.zip`).
3.  Generate `manifest.json`.
4.  Upload both to Cloudinary (`games/{slug}/{version}/`).
5.  (Optional) Call Backend Webhook to update DB version.

---
*Generated by Ether Frontend Standardization Task Force*
